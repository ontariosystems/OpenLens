name: build
description: build lens
inputs:
  win-certs:
    description: 'The HTTPS link (or base64-encoded data) to Windows Code Signing certificate.'
    required: false
    default: ''
  win-certs-password:
    description: 'The password to decrypt the certificate given in CSC_LINK for windows'
    required: false
    default: ''
  mac-certs:
    description: 'The HTTPS link (or base64-encoded data) to MacOS Code Signing certificate.'
    required: false
    default: ''
  mac-certs-password:
    description: 'The password to decrypt the certificate given in CSC_LINK for MacOS'
    required: false
    default: ''
  lens-path:
    description: 'The path to lens to run the script in (defaults to current)'
    required: false
    default: '.'

runs:
  using: composite
  steps:
    - name: Build Linux
      if: runner.os == 'Linux'
      shell: bash
      run: |
        cd ${{ inputs.lens-path }}
        make build ELECTRON_BUILD_EXTRA_ARGS='--x64 --arm64'
    - name: Build Windows
      env:
        CSC_LINK: ${{ inputs.win-certs }}
        CSC_KEY_PASSWORD: ${{ inputs.win-certs-password }}
if: runner.os == 'Windows'
      run: |
        cd ${{ inputs.lens-path }}
        make build
      shell: bash
    - name: Build Macos
      env:
        CSC_LINK: ${{ inputs.mac-certs }}
        CSC_KEY_PASSWORD: ${{ inputs.mac-certs-password }}
      if: runner.os == 'macOS'
      run: |
        cd ${{ inputs.lens-path }}
        make build ELECTRON_BUILD_EXTRA_ARGS='--arm64 --x64'
      shell: bash

